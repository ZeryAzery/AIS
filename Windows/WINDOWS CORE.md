# ü™ü WINDOWS SERVER CORE ü™ü


Powershell n'a pas de sensiblit√© √† la casse c'est juste visuel

```powershell
#Trouver une commande:
				gcm *bitlocker*
‚Ä¢ Afficher les aides dans une fen√™tre		help Unlock-BitLocker -ShowWindow


‚Ä¢ √âquivalent de cd en PS1: 			Set-Location
‚Ä¢ Se d√©placer √† la racine: 			Set-Location \
‚Ä¢ Se placer dans le r√©pertoire utilisateur :	cd ~ ou sl ~
‚Ä¢ Afficher l‚Äôemplacement actuel:		Get-Location (pwd is working as well...)
‚Ä¢ Afficher le contenu de C:\ :			Get-ChildItem -Path "C:\" #Commandes alternative: gci C:  dir C:  ls C:

‚Ä¢ Ctrl+Alt+Suprr :			Ouvre le gestionnaire des t√¢ches (permet d'ouvrir la fen√™tre "executer" pour ouvrir Powershell..)

‚Ä¢ Renommer la machine :	 		Rename-Computer -NewName "SRV-W19-CORE-1" -Restart
‚Ä¢ Obtenir une info: 			Get
‚Ä¢ Affichera juste le nom de l'ordi:	Get-computerInfo | Select CsName 
‚Ä¢ R√©initialiser son mot de passe : 	net user Administrateur *
‚Ä¢ R√©initialiser son MDP	sur domaine :	net user  /domain administrateur *


‚Ä¢ DL fichiers d‚Äôaide powershell :	Update-Help (Exemple : Get-Help Get-Process)
‚Ä¢ Arr√©ter un processus :		Stop-Process -Id 2960

‚Ä¢ Renommer un dossier :			Rename-Item -Path "C:\DATAS\DIRECTION" -NewName "D_DIRECTION"
‚Ä¢ Cr√©er un fichier texte :		New-Item -Path C:\Administrateur\Users\fichiertest -ItemType File
‚Ä¢ Cr√©er un fichier ou √©crase ancien :	Set-Content -Path C:\Administrateur\Users\fichiertest -Value "Texte du fichier"
‚Ä¢ Ajoute texte fichier existant :	Add-Content -Path C:\Administrateur\Users\fichiertest -Value "Ajoute Texte au fichier"

	

‚Ä¢ Menu de config du serveur:		sconfig

‚Ä¢ Addon VBox, monter iso puis :	D: et 	VBoxWidowsAdditions-amd64.exe (useless ??)
‚Ä¢ Red√©marrer:				Restart-Computer ou shutdown /r /t 0  
‚Ä¢ √âteindre:				Stop-Computer 	 ou shutdown /s /t 0  
‚Ä¢ lister un dossier: 			dir ou ls ou gci (Pour Get-ChildItem)
‚Ä¢ revenir au dossier parent:		cd ..
‚Ä¢ Chnager de r√©pertoire 		cd ou sl (pour Set-Location)

‚Ä¢ Afficher le contenu d'un fichier:	cat nom_fichier ou cat C:\chemin\nom_fichier ou gc (pour Get-Content)

‚Ä¢ tester l'√©coute d'un port 		Test-NetConnection -ComputerName localhost -Port 389


## üñºÔ∏è SYSPREP üñºÔ∏è 


Faire le sysprep avant le clone si besoin de d√©ployer l'image plusieurs fois et choisir arr√™ter au lieu de red√©marrer(pour √©viter que la machine reprenne un SID au d√©marrage)

‚Ä¢ cd \windows\system32\sysprep
‚Ä¢ .\sysprep.exe /generalize /reboot
 

## üì∂ CONFIG RESEAU üì∂ 



‚Ä¢ Afficher les infos r√©seaux:		Get-NetIPConfiguration (eq ipconfig...)
‚Ä¢ Ou mieu son Alias:			gip
‚Ä¢ Afficher plus d'infos:		gip -Detailed

‚Ä¢ Nom de la carte r√©seau:		Get-NetAdapter
‚Ä¢ Afficher les cartes r√©seau up:	Get-NetAdapter | Where-Object { $_.Status -eq "Up" }
‚Ä¢ Afficher n¬∞ carte r√©seau:		Get-NetIPInterface 
‚Ä¢ Afficher ipv4 et interfaces		Get-NetIPAddress -AddressFamily IPv4 | select IPAddress, InterfaceAlias
	
‚Ä¢ IP statique et Gateway: 		New-NetIPaddress -InterfaceIndex 4 -IPAddress 192.0.100.1 -PrefixLength 24 -DefaultGateway 10.0.0.254 (ou 4 est le num de la carte r√©seau)



‚Ä¢ Configurer le DNS:			Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses ("8.8.8.8","8.8.4.4")

‚Ä¢ Supprimer une adresse DNS :		Get-DnsClientServerAddress -InterfaceIndex 6 | Set-DnsClientServerAddress -ResetServerAddresses

‚Ä¢ V√©rifier l‚Äôacc√®s au r√©seau:		Test-Connection -ComputerName google.com


‚Ä¢ retirer adresse IP:			Remove-NetIPAddress -InterfaceIndex 4 -IPAddress 192.168.0.2 -PrefixLengh 24
	ou mieux			Remove-NetIPAddress -IPAddress 192.168.100.1 -Confirm:$false

‚Ä¢ Retirer la passerelle			Remove-NetRoute -InterfaceAlias "Ethernet" -NextHop "192.168.0.254"


‚Ä¢ D√©sactiver carte r√©seau:		Disable-NetAdapter -Name  nom_carte_r√©seau
‚Ä¢ D√©sactiver/R√©activer:			Restart-NetAdapter -Name nom_carte_r√©seau

‚Ä¢ D√©sactiver l'IPv6:			Disable-NetAdapterBindin -InterfaceAlias "ethernet" -ComponentID ms_tcpip6
‚Ä¢ D√©sactiver l'IPv6 partout:		Get-NetAdapter | ForEach-Object { Disable-NetAdapterBinding -Name $_.Name -ComponentID ms_tcpip6 }



## üìÇ Gestion des Objets üìÇ 


‚Ä¢ R√©cup hash				Get-FileHash .\Fichier\
‚Ä¢ R√©cup√©rer un hash			Get-FileHash -Algorithm -sha512 Chemin\fichier
‚Ä¢ Cr√©er des dossiers avec mkdir		mkdir COMPTABILITE, INFORMATIQUE, RH, PRODUCTION 
‚Ä¢ New-Item				Je ne veux pas en parler tellement mkdir semble plus simple -_-
‚Ä¢ Supprimer un fichier/Dossier		Remove-Item COMPTABILITE, INFORMATIQUE, RH, PRODUCTION
‚Ä¢ Son Alias				ri COMPTABILITE, INFORMATIQUE, RH, PRODUCTION

‚Ä¢ Renommer un fichier:			Rename-Item
‚Ä¢ Son Alias				rni
‚Ä¢ Renommer un fichier avec move:	mv '.\Ananlyser  le contenu d''un executable.doc' '.\Analyser executable.doc'
‚Ä¢ Alias 				mi
‚Ä¢ comparer des objects			Compare-Object -ReferenceObject "fhfufu" -DifferenceObject "fehueh"
‚Ä¢



## üìáüîç Rechercher un mot ou une expression dans un fichier üìáüîç ##

‚Ä¢ Rechercher un mot, une expression dans fichier:		Select-String -Path "C:\chemin\vers\rockyou.txt" -Pattern "mot_√†_rechercher"					 
‚Ä¢ Chercher uniquement les mots commen√ßant par "pass" :		Select-String -Path "C:\chemin\vers\rockyou.txt" -Pattern "^pass"					
‚Ä¢ Recherche sensible √† la casse:				Select-String -Path "C:\chemin\vers\rockyou.txt" -Pattern "Password" -CaseSensitive
‚Ä¢ Tous les mots contenant "pass", mais uniquement en entier (contiendra "pass" mais uniquement pr√©c√©d√© ou suivit d'un caract√®re qui ne sera pas une lettre)
								Select-String -Path "C:\chemin\vers\rockyou.txt" -Pattern "\bpass\b"

‚Ä¢ Ne pas afficher le num√©ro de ligne:	Select-String -Path "C:\Users\Axel\Desktop\rockyou.txt" -Pattern "\bpass\b" | ForEach-Object { $_.Line }

‚Ä¢ Rechercher les 10 derni√®res lignes :				Get-Content C:\Users\Axel\Desktop\rockyou.txt | Select-Object -Last 10



Formats de fichiers que Powershell peut utiliser:

üìÇ Format	üìú Support√© nativement ?	üîß M√©thode √† utiliser
TXT		‚úÖ Oui				Get-Content ou Select-String
CSV		‚úÖ Oui				Import-Csv
JSON		‚úÖ Oui				ConvertFrom-Json
XML		‚úÖ Oui				Select-Xml
DOC, DOCX	‚ùå Non				COM Object ou OpenXML
PDF		‚ùå Non				PDFtoText ou une librairie externe
XLS, XLSX	‚ùå Non				COM Object ou Import-Excel
		

## üß± PARE-FEU üß± 


‚Ä¢ r√®gles ICMP IN : 			New-NetFirewallRule -DisplayName "Autoriser ICMPv4-In" -Protocol ICMPv4 -IcmpType 8 -Direction Inbound -Action Allow
‚Ä¢ r√®gles ICMP OUT :			New-NetFirewallRule -DisplayName "Autoriser ICMPv4-Out" -Protocol ICMPv4 -IcmpType 8 -Direction Outbound -Action Allow

‚Ä¢ Ouvrir port 22 dans pare-feu:		New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22


‚Ä¢ Activer Defender: 			Set-MpPreference -DisableRealtimeMonitoring $false -DisableIntrusionPreventionSystem $false -DisableIOAVProtection $false -DisableScriptScanning $false -EnableControlledFolderAccess Enabled -EnableNetworkProtection Enabled


‚Ä¢ D√©sactiver  Defender			Set-MpPreference -DisableRealtimeMonitoring $true -DisableBehaviorMonitoring $true -DisableIntrusionPreventionSystem $true -DisableIOAVProtection $true -DisableScriptScanning $true -DisablePrivacyMode $true


	


## üìÖ MISES A JOUR üìÖ 

‚Ä¢ Installer le module maj:		Install-Module PSWindowsUpdate
‚Ä¢ Importer le module de maj:		Import-Module PSWindowsUpdate
‚Ä¢ Installer les mises √† jour:		Get-WindowsUpdate -AcceptAll -Install -AutoReboot
					
			 	
Install-WindowsUpdate -AcceptAll 

DISM /Online /Cleanup-Image /RestoreHealth
Test-NetConnection -ComputerName www.microsoft.com -Port 80



## üî¢ SSH üî¢ 
	
‚Ä¢ V√©rifier si le service est actif		Get-Process sshd ou Get-Service sshd
  Faire les mises √† jours avant installation
‚Ä¢ Installer OpenSSH Server: 			Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
‚Ä¢ D√©marrer service SSH:				Start-Service sshd
‚Ä¢ Configurer d√©marrage auto SSH:		Set-Service -Name sshd -StartupType 'Automatic'
‚Ä¢ Ouvrir port 22 dans pare-feu:			New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH Server (sshd)' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22


Cr√©er une r√®gle NAT de redirection (PortForwarding) pfsense sur interface WAN vers le port 22 sur adresse NAT IP du server core pour pouvoir utiliser client ssh depuis machine h√¥te (attention sur machine h√¥te pour la page web pfsense mettre https si erreur...) et entrer l'IP de la p√¢te WAN >> exemple : ssh administrateur@ip_p√¢te_WAN

‚Ä¢ Voir sur quel port SSH √©coute			Get-NetTCPConnection | Where-Object {$_.OwningProcess -eq (Get-Process -Name sshd).Id}
‚Ä¢ Afficher le port configur√© dans sshd_config	Get-Content "$env:ProgramData\ssh\sshd_config" | Select-String "^Port"
‚Ä¢ Afficher la r√®gle, port local et protocole 	Get-NetFirewallRule -Name *ssh* | Get-NetFirewallPortFilter | Format-Table Name, LocalPort, Protocol




## üè† INSTALLER UN CONTROLEUR DE DOMAINE üè† 


-√âtape 1 : Installer les fonctionnalit√©s

‚Ä¢ Installer le r√¥le AD DS:			Install-WindowsFeature -Name AD-Domain-Services -IncludeManagementTools
‚Ä¢ Importer le module AD DS:			Import-Module ADDSDeployment

-√âtape 2 : Promouvoir le serveur en contr√¥leur de domaine

‚Ä¢ Ajouter domaine nouvelle for√™t:		Install-ADDSForest -DomainName "TSSR.INFO" -DomainNetbiosName "TSSR" -SafeModeAdministratorPassword (ConvertTo-SecureString -AsPlainText "Mon_mot_de_passe" -Force) -InstallDNS	
‚Ä¢ Joindre le domaine:				Add-Computer -DomainName TSSR.INFO

‚Ä¢ Ret√©l√©charger les modules pour le r√©plicat :	Install-WindowsFeature -Name AD-Domain-Services -IncludeManagementTools

‚Ä¢ Promouvoir en controleur de domaine:		Install-ADDSDomainController -DomainName "TSSR.INFO" -SafeModeAdministratorPassword (ConvertTo-SecureString -AsPlainText "Mon_mot_de_passe" -Force) -InstallDNS

Ou mieux et plus simple :

‚Ä¢ Promouvoir en controleur de domaine:  : 	Install-ADDSDomainController -DomainName "domain.tld" -InstallDns:$true -Credential (Get-Credential "DOMAIN\administratreur")


> Sur machine cliente
‚Ä¢ Joindre domaine:				Add-Computer -DomainName "example.com" -Credential (New-Object PSCredential ("administrateur@tssr.info", (ConvertTo-SecureString "Mon_mot_de_passe" -AsPlainText -Force))) -Restart
	\\	 :				Add-Computer -DomainName "votre_nom_de_domaine" -Credential (Get-Credential) -Restart

/!\  Ne pas oublier de mettre dans le nom d'utilisateur le nom du domaine avant "TSSR\administrateur"...
‚Ä¢ Installer tous les outils RSAT:	Get-WindowsCapability -Name RSAT* -Online | Add-WindowsCapability -Online



			


## üëÆ CREER UN NOUVEL UTILISATEUR ADMIN DU DOMAINE üëÆ 


‚Ä¢ Cr√©er un nouvel utilisateur : 		New-ADUser -Name "admaxel" -GivenName "Adm" -Surname "axel" -SamAccountName "admaxel" -UserPrincipalName "admaxel@tssr-cybe
r.org" -AccountPassword (ConvertTo-SecureString "*******" -AsPlainText -Force) -Enabled $true

‚Ä¢ Voir les groupes admin : 	Get-ADGroup -Filter 'Name -like "*admin*"'
				Get-ADGroup -Filter 'Name -like "*strat√©gie*"'



‚Ä¢ Ajouter l'utilisateur "admaxel" aux groupes admin  : 


	# Liste des groupes auxquels ajouter l'utilisateur
$groupes = @(
    "Administrateurs",
    "Administrateurs du sch√©ma",
    "Administrateurs de l‚Äôentreprise",
    "Admins du domaine",
    "Propri√©taires cr√©ateurs de la strat√©gie de groupe"
)

# Ajout de l'utilisateur √† chaque groupe
foreach ($groupe in $groupes) {
    Add-ADGroupMember -Identity $groupe -Members "admaxel" -ErrorAction SilentlyContinue
}








